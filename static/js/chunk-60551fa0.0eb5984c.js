(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-60551fa0"],{5539:function(t,e,s){"use strict";s.d(e,"f",(function(){return i})),s.d(e,"g",(function(){return o})),s.d(e,"e",(function(){return r})),s.d(e,"d",(function(){return a})),s.d(e,"c",(function(){return l})),s.d(e,"b",(function(){return c})),s.d(e,"a",(function(){return u}));var n=s("b775");function i(){return Object(n["a"])({url:"/inform/p2p/list",method:"get"})}function o(t){return Object(n["a"])({url:"/inform/unRead/list",method:"get",params:t})}function r(){return Object(n["a"])({url:"/inform/p2o/list",method:"get"})}function a(t){return Object(n["a"])({url:"/inform/group/history",method:"get",params:t})}function l(t){return Object(n["a"])({url:"/inform/group/info",method:"get",params:{name:t}})}function c(t){return Object(n["a"])({url:"/inform/group/all",method:"get",params:{id:t}})}function u(t){return Object(n["a"])({url:"/inform/group/p2o/check",method:"get",params:{oid:t}})}},ba5a:function(t,e,s){},cd69:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"message-list",attrs:{id:"message-box"}},[t.showHistory?t._e():s("el-button",{staticStyle:{"align-self":"center",padding:"5px"},attrs:{id:"btn-more",type:"info",round:""},on:{click:t.showMore}},[t._v("查看历史")]),t._l(t.history,(function(e,n){return s("div",{key:n,staticClass:"message-item",style:{"align-self":e.sender.id!==t.id?"flex-start":"flex-end"},attrs:{id:"dialog"+n}},[e.sender.id!==t.id?s("el-avatar",{attrs:{size:70,src:e.sender.avatar}}):t._e(),s("div",{staticClass:"message-item-content"},[s("div",{staticClass:"message-item-user",style:{"align-self":e.sender.id!==t.id?"flex-start":"flex-end"}},[t._v(" "+t._s(e.sender.name)+" "),s("span",[t._v(t._s(t._f("parseTime")(e.createTime,"{y}-{m}-{d} {h}:{i}")))])]),s("div",{class:"dialog-box-"+(e.sender.id!==t.id?"left":"right")},[s("div",{domProps:{innerHTML:t._s(e.content)}}),"dialog"!==e.type?s("div",{staticClass:"btn-bar"},[s("el-button",{attrs:{type:"primary"}},[t._v("同意")]),s("el-button",{attrs:{type:"danger"}},[t._v("拒绝")])],1):t._e()])]),e.sender.id===t.id?s("el-avatar",{attrs:{size:70,src:e.sender.avatar}}):t._e()],1)}))],2),s("el-form",{staticClass:"input-box"},[s("el-form-item",[s("el-input",{staticClass:"textarea",attrs:{autosize:{minRows:8,maxRows:8},type:"textarea"},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),s("el-form-item",{staticClass:"btn-bar"},[s("el-button",{attrs:{type:"primary"},on:{click:t.sendMsg}},[t._v("发送")]),s("el-button",[t._v("撤销")])],1)],1)],1)},i=[],o=(s("b0c0"),s("c740"),s("5539")),r=(s("ed08"),s("5c96")),a=null,l={name:"P2P",data:function(){return{groupName:this.$route.params.name,groupId:-1,showHistory:!1,scrollListener:null,listQuery:{page:0,limit:5,groupName:this.$route.params.name},id:this.$store.getters.id,form:{message:"new dialog",content:"",senderId:this.$store.getters.id,type:"dialog",groupName:this.$route.params.name,senderName:this.$store.getters.name},loadingOptions:{target:".app-container",lock:!0,text:"Loading",spinner:"el-icon-loading"},history:[]}},computed:{listenWebsocket:function(){return this.$store.state.websocket.message}},watch:{listenWebsocket:function(t){var e=JSON.parse(t);if("new dialog"===e.message){var s=Object.assign({},JSON.parse(e.items));if(console.log(s),s.createTime=new Date(s.createTime).getTime(),this.history.push(s),s.sender.id===this.id){var n=document.getElementById("message-box");this.form.content="",setTimeout((function(){n.scrollTo({top:n.scrollHeight,behavior:"smooth"})}),200)}else Object(o["d"])(this.listQuery),this.$notify({title:s.sender.name,message:s.content.length>25?s.content.substring(0,25)+"...":s.content,type:"success",duration:4e3})}}},created:function(){console.log(this.groupName)},mounted:function(){var t=this;Object(o["c"])(this.groupName).then((function(e){t.groupId=e.data.items.id,t.getHistory()}))},methods:{getElementTop:function(t){var e=t.offsetTop,s=t.offsetParent;while(null!==s)e+=s.offsetTop,s=s.offsetParent;return e},scrollTo:function(t,e){var s=document.getElementById(t),n=s.offsetTop,i=s.offsetParent,o=null;while(null!==i)n+=i.offsetTop,i=i.offsetParent;o="BackCompat"===document.compatMode?document.body.scrollTop:document.documentElement.scrollTop,document.getElementById("message-box").scrollTo(0,n-o+e)},showMore:function(){this.showHistory=!0,this.getHistory()},getHistory:function(){var t=this,e=document.getElementById("message-box"),s=this;this.listQuery.page++,a=r["Loading"].service(this.loadingOptions),s.listQuery.page<=2&&s.showHistory&&(s.scrollListener=function(){var t=document.getElementById("message-box");t.scrollTop<=0&&s.getHistory()},e.addEventListener("scroll",s.scrollListener)),Object(o["d"])(this.listQuery).then((function(s){for(var n in s.data.items)t.history.unshift(s.data.items[n]),t.history[0].createTime=new Date(t.history[0].createTime).getTime();setTimeout((function(){s.data.items.length>0?(console.log(s.data.items.length),t.listQuery.page>1&&null!==document.getElementById("dialog"+(s.data.items.length-1))&&t.scrollTo("dialog"+(s.data.items.length-1),0)):e.scrollTop<=0&&t.$notify({title:"已到顶部",message:"",type:"info",duration:1e3}),a.close()}),300)}))},sendMsg:function(){var t=Object.assign({},this.form);this.$store.dispatch("websocket/WEBSOCKET_SEND",JSON.stringify(t))},setTagsViewTitle:function(t){var e=this;this.$route.meta.title=t+"-通知";var s=this.$store.getters.visitedViews[this.$store.getters.visitedViews.findIndex((function(t){return t.path===e.$route.path}))];null!=s&&(s.title=t+"-通知")},setPageTitle:function(t){document.title="".concat(t)+"-通知"}}},c=l,u=(s("e3c4"),s("2877")),d=Object(u["a"])(c,n,i,!1,null,"e2b05096",null);e["default"]=d.exports},e3c4:function(t,e,s){"use strict";s("ba5a")}}]);